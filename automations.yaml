- id: '1643674563860'
  alias: 'Windows: Turn off Thermostat'
  description: ''
  triggers:
  - type: opened
    device_id: fa735c35c19ee4664531f2757012c8f2
    entity_id: binary_sensor.patio_window_entry
    domain: binary_sensor
    trigger: device
  conditions: []
  actions:
  - sequence:
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
    - if:
      - type: is_open
        condition: device
        device_id: fa735c35c19ee4664531f2757012c8f2
        entity_id: 6a095d9d15cc996e286d41b57cb6f7c5
        domain: binary_sensor
      then:
      - device_id: fc8b00114fd2a54abe764a82c0d72381
        domain: climate
        entity_id: climate.thermostat
        type: set_hvac_mode
        hvac_mode: 'off'
  mode: single
- id: '1644634889174'
  alias: 'Blinds: Evening'
  description: ''
  triggers:
  - event: sunset
    offset: '-15'
    trigger: sun
  conditions: []
  actions:
  - device_id: a251c8df7e8c5e3917cf81c6dcee054f
    domain: cover
    entity_id: 3b17943518bd025c07c97022e39aa8fd
    type: set_position
    position: 0
  - device_id: 5bfd9bc8850d74371e641574a7dbc496
    domain: cover
    entity_id: 0c3820c1b37eb601364270a3b665f22d
    type: set_position
    position: 0
  - device_id: f43e11190b93158cec468714e5142330
    domain: cover
    entity_id: cover.living_room_blinds_2
    type: set_position
    position: 0
  - device_id: bacbe9810633979bb5f8318272e5e77e
    domain: cover
    entity_id: cover.office_blinds
    type: set_position
    position: 0
  - device_id: f14534d326b7fb00fd3da43650617fd6
    domain: cover
    entity_id: cover.ryan_s_room_blinds
    type: set_position
    position: 0
  - device_id: 3b559a5a8d32b36ce5c5908e3f113149
    domain: cover
    entity_id: cover.master_bedroom_1
    type: set_position
    position: 0
  - device_id: 42795eac11d3bee733215b4b16cafb5d
    domain: cover
    entity_id: cover.master_bedroom_2
    type: set_position
    position: 0
  mode: single
- id: '1651761148757'
  alias: 'Reminder: Charge Home Batteries'
  description: ''
  triggers:
  - at: '19:00:00'
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.company_over_kill_switch
    state: 'off'
  actions:
  - if:
    - condition: zone
      entity_id: person.mitchell
      zone: zone.home
    then:
    - data_template:
        entity_id: media_player.kitchen_display
        volume_level: 0.7
      action: media_player.volume_set
    - data:
        cache: false
        entity_id: media_player.kitchen_speaker
        message: Check battery level on {{sensors}}
      action: tts.google_translate_say
    - data_template:
        entity_id: media_player.kitchen_display
        volume_level: 0.5
      action: media_player.volume_set
    else:
    - device_id: 6e4e58134b1f17ed9bbbc01d2c47ccbc
      domain: mobile_app
      type: notify
      message: Check battery level on {{sensors}}
      title: Low Battery
  variables:
    day: 0
    threshold: 20
    exclude:
      entity_id:
      - sensor.mitchell_s_iphone_battery_level
      - sensor.ryans_iphone_battery_level
      - sensor.michelle_s_iphone_battery_level
      - sensor.scarlett_battery
      - sensor.freya_battery
      - sensor.ipad_battery_level
      - sensor.ipad_battery
      - sensor.ryans_apple_watch_battery
      - sensor.michelles_apple_watch_battery
      - sensor.mitchells_apple_watch_battery
    sensors: "{% set result = namespace(sensors=[]) %} {% for state in states.sensor
      | selectattr('attributes.device_class', '==', 'battery') %}\n  {% if 0 <= state.state
      | int(-1) < threshold | int and not state.entity_id in exclude.entity_id %}\n
      \   {% set result.sensors = result.sensors + [state.name ~ ' (' ~ state.state
      ~ ' %)'] %}\n  {% endif %}\n{% endfor %} {% for state in states.binary_sensor
      | selectattr('attributes.device_class', '==', 'battery') | selectattr('state',
      '==', 'on') %}\n  {% if not state.entity_id in exclude.entity_id %}\n    {%
      set result.sensors = result.sensors + [state.name] %}\n  {% endif %}\n{% endfor
      %} {{result.sensors|join(', ')}}"
  mode: single
- id: '1654011479692'
  alias: 'Blinds: AM Sun-based'
  description: ''
  triggers:
  - event: sunrise
    offset: 0
    trigger: sun
  conditions: []
  actions:
  - device_id: 5bfd9bc8850d74371e641574a7dbc496
    domain: cover
    entity_id: 0c3820c1b37eb601364270a3b665f22d
    type: set_position
    position: 50
  - device_id: f43e11190b93158cec468714e5142330
    domain: cover
    entity_id: cover.living_room_blinds_2
    type: set_position
    position: 50
  - device_id: f14534d326b7fb00fd3da43650617fd6
    domain: cover
    entity_id: fd480d2202816f88a9b2d357ce00a99a
    type: set_position
    position: 50
  - device_id: bacbe9810633979bb5f8318272e5e77e
    domain: cover
    entity_id: cover.office_blinds
    type: set_position
    position: 50
  - device_id: 3b559a5a8d32b36ce5c5908e3f113149
    domain: cover
    entity_id: cover.master_bedroom_1
    type: set_position
    position: 100
  - device_id: 42795eac11d3bee733215b4b16cafb5d
    domain: cover
    entity_id: cover.master_bedroom_2
    type: set_position
    position: 100
  - device_id: a251c8df7e8c5e3917cf81c6dcee054f
    domain: cover
    entity_id: cover.kitchen_blinds
    type: set_position
    position: 100
  mode: single
- id: '1654011954760'
  alias: 'Blinds: PM Sun-based'
  description: ''
  triggers:
  - entity_id:
    - sun.sun
    value_template: '{{ state.attributes.azimuth }}'
    above: '177.6'
    trigger: numeric_state
  conditions: []
  actions:
  - device_id: 3b559a5a8d32b36ce5c5908e3f113149
    domain: cover
    entity_id: cover.master_bedroom_1
    type: set_position
    position: 50
  - device_id: 42795eac11d3bee733215b4b16cafb5d
    domain: cover
    entity_id: cover.master_bedroom_2
    type: set_position
    position: 50
  - device_id: a251c8df7e8c5e3917cf81c6dcee054f
    domain: cover
    entity_id: cover.kitchen_blinds
    type: set_position
    position: 50
  - device_id: bacbe9810633979bb5f8318272e5e77e
    domain: cover
    entity_id: cover.office_blinds
    type: set_position
    position: 100
  - device_id: f14534d326b7fb00fd3da43650617fd6
    domain: cover
    entity_id: fd480d2202816f88a9b2d357ce00a99a
    type: set_position
    position: 100
  - device_id: 5bfd9bc8850d74371e641574a7dbc496
    domain: cover
    entity_id: 0c3820c1b37eb601364270a3b665f22d
    type: set_position
    position: 100
  - device_id: f43e11190b93158cec468714e5142330
    domain: cover
    entity_id: cover.living_room_blinds_2
    type: set_position
    position: 100
  mode: single
- id: '1655482532951'
  alias: 'Mode: Away'
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.family_home_away
    to: away
    from: home
  conditions: []
  actions:
  - target:
      entity_id: scene.aay
    metadata: {}
    action: scene.turn_on
    data: {}
  - device_id: 552439faaaea4902b4b64fcc22ad996b
    domain: alarm_control_panel
    entity_id: alarm_control_panel.alarm_control_panel
    type: arm_away
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.vacuum_ran
        state: 'off'
      sequence:
      - device_id: 51c495a7d310b408944ceb6ff0ea24f1
        domain: vacuum
        entity_id: ebe1d35f969f87ae96c8418a22ea32e4
        type: clean
      - data: {}
        target:
          entity_id: input_boolean.vacuum_ran
        action: input_boolean.turn_on
    default: []
  - device_id: fc8b00114fd2a54abe764a82c0d72381
    domain: climate
    entity_id: climate.thermostat
    type: set_preset_mode
    preset_mode: away_indefinitely
  - action: script.turn_off_all_tvs
    metadata: {}
    data: {}
  mode: single
- id: '1656173861699'
  alias: 'Mode: Home'
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - person.michelle
    - person.mitchell
    - person.ryan
    to:
    - home
  conditions: []
  actions:
  - type: turn_on
    device_id: e2a7a1ed1dfd8c9a4c12ece758aa3856
    entity_id: light.entry_way_step_lights
    domain: light
  - action: script.thermostat_home_sleep
    metadata: {}
    data: {}
  mode: single
- id: '1657498537397'
  alias: Reset Helpers at 2300
  description: ''
  trigger:
  - platform: time
    at: '23:00:00'
  condition: []
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id:
      - input_boolean.vacuum_ran
      - input_boolean.company_over_kill_switch
  mode: single
- id: '1661609190131'
  alias: 'Reminder: Charge The Cars'
  description: ''
  triggers:
  - at: '20:00:00'
    trigger: time
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: zone
          entity_id: device_tracker.scarlett_location_tracker
          zone: zone.home
        - type: is_not_plugged_in
          condition: device
          device_id: 67413852794146bda7453759331ee1a0
          entity_id: 548a7966121e173f0540f301cf0827f7
          domain: binary_sensor
      sequence:
      - data:
          message: Scarlett is unplugged and battery is currently {{ states('sensor.scarlett_battery')
            }}.
          title: Charge Scarlett
        action: notify.mitchell_and_michelle_phones
    - conditions:
      - condition: and
        conditions:
        - condition: zone
          entity_id: device_tracker.freya_location_tracker
          zone: zone.home
        - type: is_not_plugged_in
          condition: device
          device_id: ecea222fa0985e37d2b824e945d0ac90
          entity_id: 4d564e7a77b19a97e2ec45fef5fb36b4
          domain: binary_sensor
      sequence:
      - data:
          message: Freya is unplugged and battery is currently {{ states('sensor.freya_battery')
            }}.
          title: Charge Freya
        action: notify.mitchell_and_michelle_phones
  mode: single
- id: '1661625581272'
  alias: Auto-Off Stairs Light
  description: Turn off the light on the stairs after a set amount of time.
  trigger:
  - platform: state
    entity_id:
    - light.stairs_step_lights
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition:
  - condition: state
    state: 'off'
    entity_id: input_boolean.company_over_kill_switch
  action:
  - type: turn_off
    device_id: cb23fc59122ca5a7b1a467cb477c0aae
    entity_id: light.stairs_step_lights
    domain: light
  mode: single
- id: '1661625996493'
  alias: Auto-Off Entry Way Light
  description: Turn off the light in the Entry Way after a set amount of time.
  trigger:
  - platform: state
    entity_id:
    - light.entry_way_step_lights
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  condition:
  - condition: state
    state: 'off'
    entity_id: input_boolean.company_over_kill_switch
  action:
  - type: turn_off
    device_id: e2a7a1ed1dfd8c9a4c12ece758aa3856
    entity_id: light.entry_way_step_lights
    domain: light
  mode: single
- id: '1663535298334'
  alias: NFC Laundry Washer Timer
  description: ''
  trigger:
  - platform: event
    event_type: WashingMachine_Scanned
  condition: []
  action:
  - if:
    - condition: state
      entity_id: timer.washer_tag
      state: active
    then:
    - service: timer.cancel
      data: {}
      target:
        entity_id: timer.washer_tag
    else:
    - service: timer.start
      data: {}
      target:
        entity_id: timer.washer_tag
  mode: single
- id: '1663537336336'
  alias: 'Reminder: Laundry Timer Complete'
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
  condition: []
  action:
  - service: notify.mobile_app_mitchell_s_iphone
    data:
      message: Laundry is ready.
  - service: notify.mobile_app_michelle_s_iphone
    data:
      message: Laundry is ready.
  mode: single
- id: '1663537486931'
  alias: NFC Laundry Dryer Timer
  description: ''
  trigger:
  - platform: event
    event_type: Dryer_Scanned
  condition: []
  action:
  - if:
    - condition: state
      entity_id: timer.dryer_tag
      state: active
    then:
    - service: timer.cancel
      data: {}
      target:
        entity_id: timer.dryer_tag
    else:
    - service: timer.start
      data: {}
      target:
        entity_id: timer.dryer_tag
  mode: single
- id: '1663538728916'
  alias: NFC Michelle's Office Lights
  description: ''
  trigger:
  - platform: event
    event_type: Office_Scanned
  condition: []
  action:
  - service: scene.turn_on
    target:
      entity_id: scene.michelle_s_office_lights
    metadata: {}
  mode: single
- id: '1663769309933'
  alias: Auto-Off Upstairs Hallway Light
  description: ''
  trigger:
  - platform: state
    entity_id:
    - light.upstairs_hallway_main_lights
    from: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  condition:
  - condition: state
    state: 'off'
    entity_id: input_boolean.company_over_kill_switch
  action:
  - type: turn_off
    device_id: 332440d14f4b2afdb9dfb7a60835fe1f
    entity_id: light.upstairs_hallway_main_lights
    domain: light
  mode: single
- id: '1663769727534'
  alias: Reset Helpers at 0600
  description: ''
  trigger:
  - platform: time
    at: 06:00:00
  condition: []
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.basement_check
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.status_sleeping
  mode: single
- id: '1663872498680'
  alias: NFC Gym Vac Switch
  description: ''
  trigger:
  - platform: event
    event_type: Gym_Vac_Scanned
  condition: []
  action:
  - device_id: 58a949696ac1cff3640530ba625a6bab
    domain: vacuum
    entity_id: 4dbbdf7877cd658ff4820e2317cf74aa
    type: clean
  mode: single
- id: '1663873412632'
  alias: Shortcut Company Kill Switch (Guests)
  description: ''
  trigger:
  - platform: event
    event_type: Guests
  condition: []
  action:
  - service: input_boolean.toggle
    data: {}
    target:
      entity_id: input_boolean.company_over_kill_switch
  mode: single
- id: '1664834813628'
  alias: 'Music: Second Floor Bathroom'
  description: ''
  triggers:
  - type: changed_states
    device_id: c5c52665e1c913b4e571e66f0fa4a9c2
    entity_id: e38ba6a51bb891ac4ce9146c0fbb9f8c
    domain: light
    trigger: device
  conditions: []
  actions:
  - if:
    - condition: device
      type: is_on
      device_id: c5c52665e1c913b4e571e66f0fa4a9c2
      entity_id: e38ba6a51bb891ac4ce9146c0fbb9f8c
      domain: light
    then:
    - action: media_player.volume_set
      metadata: {}
      data:
        volume_level: 0.25
      target:
        device_id: c4bb0b82c1f419b87cb0f4868120adec
    - action: music_assistant.play_media
      target:
        device_id: c4bb0b82c1f419b87cb0f4868120adec
      data:
        enqueue: play
        media_id: spotify://playlist/0HNvJ8OXNvStYGyHqCLhls
        media_type: playlist
    else:
    - action: media_player.toggle
      metadata: {}
      data: {}
      target:
        device_id: c4bb0b82c1f419b87cb0f4868120adec
  mode: single
- id: '1671619842808'
  alias: 'Vacuum: Second Floor'
  description: ''
  trigger:
  - platform: time
    at: 00:00:00
  condition: []
  action:
  - device_id: 51c495a7d310b408944ceb6ff0ea24f1
    domain: vacuum
    entity_id: ebe1d35f969f87ae96c8418a22ea32e4
    type: clean
  mode: single
- id: '1672427999221'
  alias: 'Lights: Sync on Master Bedroom 0900-1800'
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: 271ea8d8df0061cde3f8ad901a1514c9
    entity_id: light.master_bedroom_lamps
    domain: light
  condition:
  - condition: time
    before: '18:00:00'
    after: 09:00:00
  action:
  - service: light.turn_on
    data:
      kelvin: 5000
      brightness_pct: 100
    target:
      entity_id: light.master_bedroom_ceiling_fan
  mode: single
- id: '1672429044943'
  alias: 'Lights: Sync Master Bedroom lights off'
  description: ''
  trigger:
  - platform: device
    type: turned_off
    device_id: 271ea8d8df0061cde3f8ad901a1514c9
    entity_id: light.master_bedroom_lamps
    domain: light
  condition: []
  action:
  - service: light.turn_off
    data: {}
    target:
      entity_id: light.master_bedroom_ceiling_fan
  mode: single
- id: '1682447000301'
  alias: 'Fan: Ryan''s Room Temp'
  description: ''
  triggers:
  - entity_id:
    - sensor.ryansroom_temperature
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ (states(''sensor.ryansroom_temperature'') | float) - (states(''sensor.thermostat_temperature'')
        | float) >= 3 }}'
    then:
    - data:
        percentage: 80
      target:
        device_id: 1ce9c179410d08876225c7d27beaf988
      action: fan.set_percentage
    else:
    - data:
        percentage: 40
      target:
        device_id: 1ce9c179410d08876225c7d27beaf988
      action: fan.set_percentage
  mode: single
- id: '1682447081910'
  alias: 'Fan: Master Bedroom Temp'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.masterbedroom_temperature
  condition: []
  action:
  - if:
    - condition: template
      value_template: '{{ (states(''sensor.masterbedroom_temperature'') | float) -
        (states(''sensor.thermostat_temperature'') | float) >= 3 }}'
    then:
    - service: fan.set_percentage
      data:
        percentage: 80
      target:
        device_id: 9a512b1bceda54bbe57d914df9005046
    else:
    - service: fan.set_percentage
      data:
        percentage: 40
      target:
        device_id: 9a512b1bceda54bbe57d914df9005046
  mode: single
- id: '1694126178868'
  alias: 'Routine: Good Night'
  description: ''
  trigger:
  - type: occupied
    platform: device
    device_id: b9de06a17b0bcea06a09b2bc77cab245
    entity_id: 7e99bd265a7e1bc68d4e99e131554212
    domain: binary_sensor
  - type: occupied
    platform: device
    device_id: b9de06a17b0bcea06a09b2bc77cab245
    entity_id: 2445bb10ad0cf832a4b3dbe363f2af9c
    domain: binary_sensor
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.schedule_bed_time
        state: 'on'
      - condition: state
        entity_id: input_boolean.status_sleeping
        state: 'off'
      - condition: zone
        entity_id: person.michelle
        zone: zone.home
      - condition: zone
        entity_id: person.mitchell
        zone: zone.home
      - type: is_occupied
        condition: device
        device_id: b9de06a17b0bcea06a09b2bc77cab245
        entity_id: 2445bb10ad0cf832a4b3dbe363f2af9c
        domain: binary_sensor
      - type: is_occupied
        condition: device
        device_id: b9de06a17b0bcea06a09b2bc77cab245
        entity_id: 7e99bd265a7e1bc68d4e99e131554212
        domain: binary_sensor
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.schedule_bed_time
        state: 'on'
      - condition: state
        entity_id: input_boolean.status_sleeping
        state: 'off'
      - condition: zone
        entity_id: person.michelle
        zone: zone.home
      - condition: not
        conditions:
        - condition: zone
          entity_id: person.mitchell
          zone: zone.home
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.schedule_bed_time
        state: 'on'
      - condition: state
        entity_id: input_boolean.status_sleeping
        state: 'off'
      - condition: zone
        entity_id: person.mitchell
        zone: zone.home
      - condition: not
        conditions:
        - condition: zone
          entity_id: person.michelle
          zone: zone.home
  action:
  - service: script.toggle
    data: {}
    target:
      entity_id: script.good_night
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.status_sleeping
  mode: single
- id: '1763059403149'
  alias: 'Mode: On The Way Home'
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.michelle_almost_home
    to: 'on'
    from:
  - trigger: state
    entity_id:
    - binary_sensor.mitchell_almost_home
    to: 'on'
    from:
  conditions:
  - condition: device
    device_id: fc8b00114fd2a54abe764a82c0d72381
    domain: climate
    entity_id: 1dbaf24f116fd70ff7e80cbce6adf7fa
    type: is_preset_mode
    preset_mode: away_indefinitely
  actions:
  - action: script.thermostat_home_sleep
    metadata: {}
    data: {}
  - sequence:
    - delay:
        hours: 0
        minutes: 45
        seconds: 0
        milliseconds: 0
    - if:
      - condition: state
        entity_id: sensor.family_home_away
        state: away
      then:
      - device_id: fc8b00114fd2a54abe764a82c0d72381
        domain: climate
        entity_id: 1dbaf24f116fd70ff7e80cbce6adf7fa
        type: set_preset_mode
        preset_mode: away_indefinitely
      - action: notify.mobile_app_iphone
        metadata: {}
        data:
          message: '''You didn''t make it home in time, house has been set back to
            away.'''
  mode: single
- id: '1763145802563'
  alias: 'House Mode: Handler'
  description: ''
  triggers:
  - entity_id: input_select.house_mode
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.house_mode
        state: home
      sequence:
      - type: turn_on
        device_id: e2a7a1ed1dfd8c9a4c12ece758aa3856
        entity_id: light.entry_way_step_lights
        domain: light
      - action: script.thermostat_home_sleep
        metadata: {}
        data: {}
      - device_id: 51c495a7d310b408944ceb6ff0ea24f1
        domain: vacuum
        entity_id: ebe1d35f969f87ae96c8418a22ea32e4
        type: dock
    - conditions:
      - condition: state
        entity_id: input_select.house_mode
        state: away
      sequence:
      - target:
          entity_id: scene.aay
        metadata: {}
        action: scene.turn_on
        data: {}
      - device_id: 552439faaaea4902b4b64fcc22ad996b
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarm_control_panel
        type: arm_away
      - if:
        - condition: state
          entity_id: input_boolean.vacuum_ran
          state: 'off'
        then:
        - device_id: 51c495a7d310b408944ceb6ff0ea24f1
          domain: vacuum
          entity_id: ebe1d35f969f87ae96c8418a22ea32e4
          type: clean
        - data: {}
          target:
            entity_id: input_boolean.vacuum_ran
          action: input_boolean.turn_on
      - device_id: fc8b00114fd2a54abe764a82c0d72381
        domain: climate
        entity_id: climate.thermostat
        type: set_preset_mode
        preset_mode: away_indefinitely
      - action: script.turn_off_all_tvs
        metadata: {}
        data: {}
    - conditions:
      - condition: state
        entity_id: input_select.house_mode
        state: on the way home
      sequence:
      - action: script.thermostat_home_sleep
        metadata: {}
        data: {}
      - sequence:
        - delay:
            hours: 0
            minutes: 45
            seconds: 0
            milliseconds: 0
        - if:
          - condition: state
            entity_id: sensor.family_home_away
            state: away
          then:
          - device_id: fc8b00114fd2a54abe764a82c0d72381
            domain: climate
            entity_id: 1dbaf24f116fd70ff7e80cbce6adf7fa
            type: set_preset_mode
            preset_mode: away_indefinitely
          - action: notify.mobile_app_iphone
            metadata: {}
            data:
              message: '''You didn''t make it home in time, house has been set back
                to away.'''
  mode: single
